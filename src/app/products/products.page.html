<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>Productos</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="goToCart()">
        <ion-icon name="cart" slot="icon-only"></ion-icon>
        <ion-badge *ngIf="cartItemCount > 0" color="danger">{{ cartItemCount }}</ion-badge>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">Productos</ion-title>
    </ion-toolbar>
  </ion-header>

  <!-- Search Bar -->
  <ion-searchbar 
    [(ngModel)]="searchQuery" 
    (ionInput)="onSearch($event)"
    placeholder="Buscar productos..."
    show-clear-button="focus">
  </ion-searchbar>

  <!-- Categories -->
  <ion-segment [(ngModel)]="selectedCategory" (ionChange)="onCategoryChange($event)">
    <ion-segment-button value="all">
      <ion-label>Todos</ion-label>
    </ion-segment-button>
    <ion-segment-button *ngFor="let category of categories" [value]="category.name">
      <ion-label>{{ category.name }}</ion-label>
    </ion-segment-button>
  </ion-segment>

  <!-- Products Grid -->
  <div class="products-container">
    <ion-grid>
      <ion-row>
        <ion-col size="6" size-md="4" size-lg="3" *ngFor="let product of filteredProducts">
          <ion-card class="product-card" (click)="viewProduct(product)">
            <img [src]="product.image" [alt]="product.name" class="product-image">
            <ion-card-header>
              <ion-card-title class="product-title">{{ product.name }}</ion-card-title>
              <ion-card-subtitle class="product-price">${{ product.price | number:'1.2-2' }}</ion-card-subtitle>
            </ion-card-header>
            <ion-card-content>
              <div class="product-rating">
                <ion-icon name="star" *ngFor="let star of getStars(product.rating)" color="warning"></ion-icon>
                <span class="rating-text">{{ product.rating }} ({{ product.reviews }})</span>
              </div>
              <ion-button 
                expand="block" 
                size="small" 
                (click)="addToCart(product, $event)"
                [disabled]="product.stock === 0">
                <ion-icon name="add" slot="start"></ion-icon>
                {{ product.stock === 0 ? 'Agotado' : 'Agregar' }}
              </ion-button>
            </ion-card-content>
          </ion-card>
        </ion-col>
      </ion-row>
    </ion-grid>
  </div>

  <!-- Loading Spinner -->
  <div *ngIf="isLoading" class="loading-container">
    <ion-spinner name="crescent"></ion-spinner>
    <p>Cargando productos...</p>
  </div>

  <!-- Empty State -->
  <div *ngIf="!isLoading && filteredProducts.length === 0" class="empty-state">
    <ion-icon name="search" size="large" color="medium"></ion-icon>
    <h3>No se encontraron productos</h3>
    <p>Intenta con otros términos de búsqueda</p>
  </div>
</ion-content>
