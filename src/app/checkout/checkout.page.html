<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>Finalizar Compra</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">Finalizar Compra</ion-title>
    </ion-toolbar>
  </ion-header>

  <form [formGroup]="checkoutForm" (ngSubmit)="onCheckout()">
    <!-- Shipping Address -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>Dirección de Envío</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-item>
          <ion-label position="stacked">Dirección Completa</ion-label>
          <ion-textarea 
            formControlName="shippingAddress"
            placeholder="Ingresa tu dirección completa"
            rows="3">
          </ion-textarea>
        </ion-item>
      </ion-card-content>
    </ion-card>

    <!-- Payment Method -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>Método de Pago</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-radio-group formControlName="paymentMethod">
          <ion-item>
            <ion-radio slot="start" value="credit-card"></ion-radio>
            <ion-label>
              <h3>Tarjeta de Crédito</h3>
              <p>Visa, Mastercard, American Express</p>
            </ion-label>
          </ion-item>
          <ion-item>
            <ion-radio slot="start" value="debit-card"></ion-radio>
            <ion-label>
              <h3>Tarjeta de Débito</h3>
              <p>Pago inmediato desde tu cuenta</p>
            </ion-label>
          </ion-item>
          <ion-item>
            <ion-radio slot="start" value="paypal"></ion-radio>
            <ion-label>
              <h3>PayPal</h3>
              <p>Pago seguro con PayPal</p>
            </ion-label>
          </ion-item>
        </ion-radio-group>
      </ion-card-content>
    </ion-card>

    <!-- Order Summary -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>Resumen del Pedido</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-list>
          <ion-item *ngFor="let item of cartItems">
            <ion-thumbnail slot="start">
              <img [src]="item.product.image" [alt]="item.product.name">
            </ion-thumbnail>
            <ion-label>
              <h3>{{ item.product.name }}</h3>
              <p>Cantidad: {{ item.quantity }}</p>
            </ion-label>
            <div slot="end">
              <span class="item-total">${{ item.totalPrice | number:'1.2-2' }}</span>
            </div>
          </ion-item>
        </ion-list>
        
        <div class="order-summary">
          <div class="summary-row">
            <span>Subtotal:</span>
            <span>${{ cartTotal | number:'1.2-2' }}</span>
          </div>
          <div class="summary-row">
            <span>Envío:</span>
            <span>Gratis</span>
          </div>
          <div class="summary-row total">
            <span>Total:</span>
            <span>${{ cartTotal | number:'1.2-2' }}</span>
          </div>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Checkout Button -->
    <div class="checkout-section">
      <ion-button 
        expand="block" 
        size="large" 
        type="submit"
        [disabled]="checkoutForm.invalid || isLoading">
        <ion-spinner *ngIf="isLoading" name="crescent"></ion-spinner>
        <span *ngIf="!isLoading">Confirmar Pedido - ${{ cartTotal | number:'1.2-2' }}</span>
      </ion-button>
    </div>
  </form>
</ion-content>
